- name: Install AWS cli
  hosts: hosts
  become: False
  tasks:
    - get_url:
        url="https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"
        dest="{{playbook_dir}}/out/awscliv2.zip"
      register: get_aws_cli
    - debug: 
        msg="solr was downloaded"
    - name: Unzip
      ansible.builtin.unarchive:
        src: "{{playbook_dir}}/out/awscliv2.zip" 
        dest: "{{playbook_dir}}/out/"
    - name: Install
      become: True
      ansible.builtin.command: "bash {{playbook_dir}}/out/aws/install --update"
- name: Install AWS vault
  hosts: hosts
  become: False
  tasks:
    - get_url:
        url: "https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh"
        dest: "{{playbook_dir}}/out/brew_install.sh"
        mode: '0751'
      name: Download brew
      register: get_aws_cli
    - name: Install brew
      become: False
      ansible.builtin.shell: |
        CI=1 
        {{playbook_dir}}/out/brew_install.sh
    # Dont forget to run
    # (echo; echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"') >> /home/javanegas/.zshrc
    # eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
    - community.general.homebrew:
        name: aws-vault
        state: latest
        update_homebrew: true     
